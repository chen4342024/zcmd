(function(a){a.fn.extend({regionselector:function(b){var c={url:"",param:"value",params:null,cache:!1,loading:'<img src="//w.zuzuche.com/img/loading-16.gif" border="0" />',empty:'<a class="zzc-selector-empty" href="javascript:void(0);">暂无</a>',text:"请选择城市地区",spTitle:", ",spValue:"#@# ",valueIdArr:null,tabArr:["A,B,C,D,E","F,G,H,I,J","K,L,M,N,O","P,Q,R,S,T","U,V,W,X,Y,Z"],recently:10,type:"region",rowSize:5,rowSize2:4,onShow:null,onHide:null,onInit:null,onSelected:null},d=a.extend({},c,b),e=this;if(0!=e.length){if(d.selectorId=e.attr("id"),!d.selectorId)return alert("zzc selector id error"),void 0;var f=e.parent();if(!f)return alert("zzc selector parent error"),void 0;if(f.attr("id")?d.selectorParentId=f.attr("id"):(d.selectorParentId=d.selectorId+"_parent",f.attr("id",d.selectorParentId)),!d.valueIdArr)return alert("zzc selector valueIdArr error"),void 0;for(var g=Array(d.valueIdArr.length),h=null,i=null,j=Array(d.valueIdArr.length),k=0;d.valueIdArr.length>k;k++){var l=d.valueIdArr[k],m=a("#"+l);if(1>m.length)return alert("zzc selector valueId "+l+" error"),void 0;j[k]=m}d.containerId=d.selectorId+"_container",d.containerTabId=d.selectorId+"_container_tab",d.containerRecentlyId=d.selectorId+"_container_recently",d.containerModelsId=d.selectorId+"_container_models",f.after('<div id="'+d.containerId+'" class="gm-box"><div id="'+d.containerTabId+'" class="tab-bg"></div><div id="'+d.containerRecentlyId+'" class="gp-Recently"></div><div id="'+d.containerModelsId+'"></div>');var n=a("#"+d.containerId),o=a("#"+d.containerTabId),p=a("#"+d.containerRecentlyId),q=a("#"+d.containerModelsId),r=["410881","429004","429005","429006","429021","460200","469001","469002","469003","469005","469006","469007","469025","469026","469027","469028","469030","469031","469033","469034","469035","469036","469037","469038","469039","620200","659001","659002","659003","659004","710500","710600","711100","711200","711300","711400","711500","711600","711700","711900","712100","712200","712300","712400","712500","712600","712700","820100","820200","990100"],s=function(){if(""==e.val()){e.val(d.text),e.attr("title",d.text);for(var b="",c=0;j.length>c;c++){var f=j[c];f&&f.length>0&&""!=f.val()&&(b+=f.val()+",")}if(""!=b){var g="";d.cache||(g=(new Date).getTime());var h="/api/get_selector_json.php?callback=?&t="+g,i=0;d.params&&(i=d.params.company_id);var k={act:"selector",type:d.type,company_id:i,region_ids:b};a.getJSON(h,k,function(b){if(b&&1==b.status&&b.items&&b.items.length>0){for(var c="",f="",g="",h=0;b.items.length>h;h++){var i=b.items[h];f+=g+i.title,g=d.spTitle,""==c&&(c=i.letter)}e.val(f),e.attr("title",f);for(var h=0;d.tabArr.length>h;h++){var j=d.tabArr[h];if(j.indexOf(c)>-1){e.attr("tabrel",h);break}}var k=d.onInit;a.isFunction(k)&&k(b.items)}})}}};s();var t=function(a,b){var c=b.offset().top,d=b.innerHeight(),e=b.parents(".gp-City"),f=e.offset().top,g=e.attr("h");void 0==g?(g=e.innerHeight(),e.attr("h",g)):g=parseInt(g,10);var h=c+d-f-g-1+"px";a.css("top",h),a.css("display","block");var i=b.outerHeight(),j=g/i;j=Math.round(j);var k=(c-f-1)/i;k=Math.round(k)+1;var l=a.innerHeight()/i;l=Math.round(l),k+l>j&&(g=(k+l)*i),e.height(g)},u=function(b){var c=a(b.target);if(!(c.closest("#"+d.selectorParentId).length>0)){for(var e=!1;c.length>0&&(c=c.parent(),!(1>c.length));)if(c.attr("id")==d.containerId){e=!0;break}e||w()}},v=function(){H(),J(),q.html(d.loading),n.bgiframe(),n.show(),a(document).unbind("click",u),a(document).bind("click",u);var b=d.onShow;a.isFunction(b)&&b()},w=function(){n.hide(),q.html(""),p.html(""),o.html(""),a(document).unbind("click",u);var b=d.onHide;a.isFunction(b)&&b()},x=function(a,b){for(var c=b-1,d=0;g.length>d;d++)d==c?g[d]=a:d>c&&(g[d]=null)},y=function(a,b){var c=d.params;return c||(c={}),c.level=a,c[d.param]=b,c},z=function(b,c,e){var f="";d.cache||(f=(new Date).getTime());var g=d.url;g+=0>g.indexOf("?")?"?t="+f:"&t="+f;var h=y(c,e);a.getJSON(g,h,function(a){a&&1==a.status?F(b,c,a.items):alert("服务器繁忙，请稍候再试")})},A=function(b){if(i){var c="",f="";1==b?(c=i.attr("plevel"),f=i.attr("pvalue")):(c=i.attr("level"),f=i.attr("value"),i=null);var g=d.selectorId+"_item_"+c+"_"+f;a("#"+g).click()}if(b>=j.length)return e.removeAttr("zzcinit"),void 0;var h=e.attr("zzcinit");if("1"==h){for(var k=q.find(".zzc-selector-init"),l=0;k.length>l;l++)$item=a(k[l]),$item.attr("level")==b&&$item.click();1>k.length&&e.removeAttr("zzcinit")}},B=function(){for(var b="",c="",f=0;g.length>f;f++)$item=g[f],$item?(""!=c&&(b+=d.spTitle,c+=d.spValue),b+=$item.attr("title"),c+=$item.attr("value"),void 0!=$item.attr("flag")&&j[f].attr("flag",$item.attr("flag")),j[f].attr("title",$item.attr("title")),j[f].val($item.attr("value"))):(j[f].removeAttr("flag"),j[f].removeAttr("title"),j[f].val(""));e.val(b),e.attr("title",b),h&&e.attr("tabrel",h.attr("rel")),I();var i=d.onSelected;a.isFunction(i)&&i(j,g),w()},C=function(b){h&&h.removeClass("ontab"),q.html(d.loading),h=a(b),h.addClass("ontab"),z(q,1,h.attr("value"))},D=function(){for(var b="",c="",f=0;j.length>f;f++){var k=j[f];if(k){""!=c&&(b+=d.spTitle,c+=d.spValue);var l="",m="",n=void 0;0==f?(l=i.attr("ptitle"),m=i.attr("pvalue"),n=i.attr("pflag")):(l=i.attr("title"),m=i.attr("value"),n=i.attr("flag")),b+=l,c+=m,void 0!=n&&k.attr("flag",n),k.attr("title",l),k.val(m)}}e.val(b),e.attr("title",b),h&&e.attr("tabrel",h.attr("rel")),i=null;var o=d.onSelected;a.isFunction(o)&&o(j,g),w()},E=function(b){if(i=a(b),3>j.length)return D(),void 0;var c=d.selectorId+"_tab_"+i.attr("rel");if(h&&h.attr("id")==c){var e=d.selectorId+"_item_"+i.attr("plevel")+"_"+i.attr("pvalue");a("#"+e).click()}else a("#"+c).click()},F=function(a,b,c){var d=S[b-1];d(a,c),A(b)},G=function(b){if($item=a(b),!$item.hasClass("Has")){var c=$item.attr("level");if(c=parseInt(c,10),x($item,c),c>=R.length)return B(),void 0;if(2==c){var d=$item.attr("nonext");if("1"==d){var f=e.attr("zzcinit");return"1"!=f?B():e.removeAttr("zzcinit"),void 0}}var g=R[c-1]($item);g&&z(g,c+1,$item.attr("value"))}},H=function(a){var b="";if(1>d.tabArr.length){var c=d.selectorId+"_tab_0";b+='<a href="javascript:void(0);" id="'+c+'" rel="0" value="" class="zzc-selector-tab ontab">A-Z</a>'}for(var e=0;d.tabArr.length>e;e++){var c=d.selectorId+"_tab_"+e,f=d.tabArr[e],g=f.replace(/,/g," "),h="zzc-selector-tab ";e==a&&(h+="ontab "),b+='<a href="javascript:void(0);" id="'+c+'" rel="'+e+'" value="'+f+'" class="'+h+'">'+g+"</a>"}b+='<em class="r c77" style="line-height:26px;">《省份拼音首字母</em>',b+='<div class="clear"></div>',o.html(b),1>d.tabArr.length&&o.css("display","none"),o.find(".zzc-selector-tab").click(function(){C(this)})},I=function(){var b=g[0],c=g[1],e="";d.cache||(e=(new Date).getTime());var f="/api/get_selector_json.php?callback=?&t="+e,i=0;d.params&&(i=d.params.company_id);var j={act:"add",type:d.type,company_id:i,size:d.recently,value:c.attr("value"),title:c.attr("title"),level:c.attr("level"),rel:h.attr("rel"),pvalue:b.attr("value"),ptitle:b.attr("title"),plevel:b.attr("level")};a.getJSON(f,j,function(){})},J=function(){p.html(d.loading);var b="";d.cache||(b=(new Date).getTime());var c="/api/get_selector_json.php?callback=?&t="+b,e=0;d.params&&(e=d.params.company_id);var f={act:"hot",type:d.type,company_id:e,size:d.recently};a.getJSON(c,f,function(a){a&&1==a.status&&K(a.items)})},K=function(a){var b="";b+="热门城市：",1>a.length&&(b+=d.empty);for(var c=0;a.length>c;c++){var e=a[c];b+='<a class="zzc-selector-recently" href="javascript:void(0);" title="'+e.title+'" value="'+e.value+'" level="'+e.level+'" rel="'+e.rel+'" ptitle="'+e.ptitle+'" pvalue="'+e.pvalue+'" plevel="'+e.plevel+'">'+e.title+"</a>"}p.html(b),p.find(".zzc-selector-recently").click(function(){E(this)})},L=function(a,b){for(var c=1,e=j[c-1],f=e.val(),g="",h=0,i=0;b.length>i;i++){var k=b[i],l=k.children;if(!l||1>l.length)i==h&&(h=i+1);else{k.title=k.title||"&nbsp;";var m=i==h?" nobor":"";g+='<ul class="gp-Models'+m+'"><li class="cls">'+k.title+"</li>",g+='<li class="car-list">';for(var n=!1,o=0;l.length>o;o++){var p=l[o],q=d.selectorId+"_item_"+c+"_"+p.value,r="zzc-selector-"+c;p.value==f&&(r+=" zzc-selector-init"),0==o%d.rowSize&&(g+="<span>",n=!0),g+='<a href="javascript:void(0);" id="'+q+'" class="'+r+'" level="'+c+'" title="'+p.title+'" value="'+p.value+'"><em>'+p.title+"</em></a>",o%d.rowSize==d.rowSize-1&&(g+='</span><div class="gp-City"></div>',n=!1)}n&&(g+='</span><div class="gp-City"></div>'),g+='<div class="clear"></div>',g+='</li><li class="clear"></li></ul>'}}a.html(g),a.find(".zzc-selector-"+c).click(function(){G(this)})},M=function(b,c){var e=2,f=j[e-1],g=f.val(),h="<ul>";1>c.length&&(h+=d.empty);for(var i=0;c.length>i;i++){var k=c[i],l=k.children;if(l&&!(1>l.length)){var m="";0==i%3&&(m='class="both"'),h+="<li "+m+">",h+="<span>"+k.title+'</span><div class="City-list">';for(var n=0;l.length>n;n++){var o=l[n],p=d.selectorId+"_item_"+e+"_"+o.value,q="zzc-selector-"+e;o.value==g&&(q+=" zzc-selector-init");var s=a.inArray(o.value,r)>=0?"1":"0";h+='<a href="javascript:void(0);" id="'+p+'" class="'+q+'" level="'+e+'" title="'+o.title+'" value="'+o.value+'" nonext="'+s+'"><em>'+o.title+"</em></a>"}h+="</div></li>"}}h+='<li class="Region-list" style="position:relative;z-index:9999;display:none;"></li></ul>',b.html(h),b.attr("h",b.innerHeight()),b.find(".zzc-selector-"+e).click(function(){G(this)})},N=function(a,b){var c=3,e=j[c-1],f=e.val(),h="<div>";1>b.length&&(h+=d.empty);for(var i=0;b.length>i;i++){var k=b[i],l="zzc-selector-"+c;k.value==f&&(l+=" zzc-selector-init"),h+='<a href="javascript:void(0);" class="'+l+'" level="'+c+'" title="'+k.title+'" value="'+k.value+'" flag="'+k.flag+'">'+k.title+"</a>"}h+='<div class="zzc-selector-rx R-x"></div></div>',a.html(h),a.attr("h",a.innerHeight()),t(a,g[1]),a.find(".zzc-selector-"+c).click(function(){G(this)}),a.find(".zzc-selector-rx").click(function(){var b=q.find(".on-list-c");b.removeClass("on-list-c"),a.hide(),a.html("");var c=a.parents(".gp-City");return c.height(c.attr("h")),!1})},O=function(a){var b=q.find(".on-list-b");b.removeClass("on-list-b"),a.addClass("on-list-b");var c=q.find(".gp-City");c.hide(),c.html("");var e=a.parent().next();return e.css("height","auto"),e.html(d.loading),e.show(),e},P=function(a){var b=q.find(".on-list-c");b.removeClass("on-list-c"),a.addClass("on-list-c");var c=q.find(".Region-list");c.hide(),c.html("");var e=a.parents(".gp-City"),f=e.find(".Region-list");return f.html(d.loading),t(f,a),f.unbind("mouseenter mouseleave"),f.hover(function(){f.addClass("Region-hover")},function(){f.removeClass("Region-hover")}),f},Q=function(){return null},R=[O,P,Q];R=R.slice(0,d.valueIdArr.length);var S=[L,M,N];return S=S.slice(0,d.valueIdArr.length),f.click(function(){e.attr("zzcinit","1"),v();var b=e.attr("tabrel");b=b?parseInt(b,10):0;var c=d.selectorId+"_tab_"+b;h=a("#"+c),h.click()}),{setParams:function(b){d.params=a.extend({},d.params,b)}}}}})})(jQuery);